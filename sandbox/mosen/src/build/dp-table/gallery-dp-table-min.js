YUI.add("gallery-dp-table",function(c){c.namespace("DP").CellRenderers={date:function(f,g,e){var h=f[g];if(b.isDate(h)){e.set("innerHTML",c.DataType.Date.format(h,{format:"%x"}));}},niceDate:function(h,i,f){var k=h[i];if(b.isDate(k)){var g=new Date();g.setHours(0,0,0,0);var j=k-g,e=j/1000/60/60/24;if(e>=0&&e<=6){if(e<1){f.set("innerHTML","Today");}else{if(e<2){f.set("innerHTML","Tomorrow");}else{f.set("innerHTML",c.DataType.Date.format(k,{format:"%A"}));}}}else{if(e>-2&&e<0){f.set("innerHTML","Yesterday");}else{f.set("innerHTML",c.DataType.Date.format(k,{format:"%x"}));}}}},hash:function(d){return function(h,j,e){var g=d;var i=c.one(g),f=c.JSON.parse(i.get("innerHTML"));e.set("innerHTML",f[h[j]]);};},progress:function(){return function(j,l,h){var f=parseInt(j[l],0),m='<div class="yui3-dp-cellrenderer-progress-text">{text}</div>',d='<div class="yui3-dp-cellrenderer-progress" style="width: {width}%">{textnode}</div>',e='<div class="yui3-dp-cellrenderer-progress-wrap">{bar}</div>';var g=c.substitute(m,{text:f+"%"});var k=c.substitute(d,{width:f,textnode:g});var i=c.substitute(e,{bar:k});h.append(a.create(i));};}};var b=c.Lang,a=c.Node;c.namespace("DP").Table=c.Base.create("dp-table",c.Widget,[],{initializer:function(){this.publish("success",{defaultFn:this._defResponseSuccessFn});this.publish("loading",{defaultFn:this._defLoadingFn});this._ioHandlers={complete:c.bind(this._handleResponse,this,"complete"),success:c.bind(this._handleResponse,this,"success"),failure:c.bind(this._handleResponse,this,"failure"),end:c.bind(this._handleResponse,this,"end")};},destructor:function(){this._tbodyNode.detach("click");this._tbodyNode.detach("mouseenter");this._tbodyNode.detach("mouseleave");this._tbodyNode=null;this._tableNode=null;},renderUI:function(){this._tbodyNode=a.create(c.substitute(this.TBODY_TEMPLATE,{className:this.getClassName("tbody")}));this._tableNode=a.create(c.substitute(this.TABLE_TEMPLATE,{className:this.getClassName("table")}));this._tableNode.append(this._tbodyNode);this.get("contentBox").append(this._tableNode);},bindUI:function(){this._tbodyNode.delegate("selectstart",function(d){d.preventDefault();},"tr",this);this.after("dataChange",this._afterDataChange);this.after("loadingChange",this._afterLoadingChange);this.after("queryParametersChange",this._afterQueryParametersChange);},syncUI:function(){this.load("");},_ioHandlers:null,_tbodyNode:null,_tableNode:null,_renderTableRows:function(){var g=this.get("data"),m,o=this.get("cells");this._tbodyNode.set("content","");if(g.results.length>0){for(var h=0;h<g.results.length;h++){m=(h%2)?"row":"row-alt";var j=a.create(c.substitute(this.ROW_TEMPLATE,{trClassName:this.getClassName(m)}));for(var l=0;l<o.length;l++){var n=o[l],k=n.field,e=n.width,f=a.create(c.substitute(this.CELL_TEMPLATE,{tdClassName:this.getClassName("cell")}));if(undefined===n.renderer){f.setContent(g.results[h][k]);}else{var d=n.renderer({value:g.results[h][k]});if(d!==undefined){f.setContent(d);}}f.set("width",e);j.append(f);}this._tbodyNode.append(j);}}else{this._tbodyNode.append(a.create(c.substitute(this.ZEROROWS_TEMPLATE,{colspan:this.get("cells").length,message:this.get("strings.zerorows")})));}},load:function(d){var e=this.get("dataSource");this._io=e.sendRequest({request:d,callback:this._ioHandlers});this.fire("loading",{id:this._io,request:d});},_handleResponse:function(d,f){this.fire(d,{id:this._io,response:f.response});this._io=null;},handleParameterChange:function(d){var f=this.get("queryParameters");f[d.type]=d.parameters;this.set("queryParameters",f);},_defResponseSuccessFn:function(d){this.set("data",d.response);this.set("loading",false);},_defLoadingFn:function(d){this.set("loading",true);},_afterDataChange:function(d){this._renderTableRows();},_afterLoadingChange:function(d){var f=this.get("loading");if(f){}else{}},_afterQueryParametersChange:function(){var h=this.get("queryParameters"),f=Array(),g,e;for(g in h){for(e in h[g]){if(h[g][e].length>0){f.push(e+"="+h[g][e]);}}}var d="?"+f.join("&");this.load(d);},ZEROROWS_TEMPLATE:'<tr><td colspan="{colspan}">{message}</td></tr>',ROW_TEMPLATE:'<tr class="{trClassName}"></tr>',CELL_TEMPLATE:'<td class="{tdClassName}"></td>',TABLE_TEMPLATE:'<table class="{className}"></table>',TBODY_TEMPLATE:'<tbody class="{className}"></tbody>'},{NAME:"dp-table",ATTRS:{strings:{value:{loading:"Loading...",zerorows:"No results available"}},cells:{value:Array()},dataSource:{value:null},data:{value:null,validator:b.isArray},loading:{value:false,validator:b.isBoolean},queryParameters:{value:Array(),validator:b.isArray}}});var b=c.Lang;c.namespace("DP").TableHeaders=c.Base.create("dp-table-headers-plugin",c.Plugin.Base,[],{initializer:function(d){this.publish("sort",{defaultFn:this._defSortFn});this.publish("columnover",{defaultFn:this._uiSetColumnOver});this.publish("columnout",{defaultFn:this._uiSetColumnOut});this.publish("queryUpdate",{defaultFn:this._defQueryUpdateFn});this.afterHostEvent("render",this.renderUI);this.afterHostMethod("bindUI",this.bindUI);},renderUI:function(){this._renderTableHead();this._renderTableHeadColumns();},bindUI:function(){this.after("columnsChange",this._afterColumnsChange);this._theadNode.delegate("selectstart",function(d){d.preventDefault();},"th",this);this._theadNode.delegate("click",function(d){this.fire("sort",{headerTarget:d.currentTarget});},"th",this);this._theadNode.delegate("mouseenter",function(d){this.fire("columnover",{headerTarget:d.currentTarget});},"th",this);this._theadNode.delegate("mouseleave",function(d){this.fire("columnout",{headerTarget:d.currentTarget});},"th",this);},syncUI:function(){},destructor:function(){this._theadNode.detach("selectstart");this._theadNode.detach("click");this._theadNode.detach("mouseenter");this._theadNode.detach("mouseleave");this._theadNode=null;},_renderTableHead:function(){this._theadNode=a.create(c.substitute(this.THEAD_TEMPLATE,{className:this.get("host").getClassName("tableHeaders","thead")}));this.get("host").append(this._theadNode);},_renderTableHeadColumns:function(){},_theadNode:null,THEAD_TEMPLATE:'<thead class="{className}"></thead>',ROW_TEMPLATE:'<tr class="{className}"></tr>',COLUMN_TEMPLATE:'<th class="{className}">{value}</th>',COLUMN_SORT_INDICATOR_TEMPLATE:'<div class="{className}">&nbsp;</div>',COLUMN_LABEL_TEMPLATE:'<span class="{className}">{label}</span>'},{NS:"tableHeaders",ATTRS:{}});
},"@VERSION@",{requires:["substitute","json-parse","node","widget","datatype","dataschema","datasource","node-pluginhost"]});YUI.add("gallery-dp-table",function(a){},"@VERSION@",{use:["dp-table"],skinnable:false});