YUI.add("gallery-dp-table",function(e){e.namespace("DP").CellRenderers={date:function(g,h,f){var i=g[h];if(c.isDate(i)){f.set("innerHTML",e.DataType.Date.format(i,{format:"%x"}));}},niceDate:function(i,j,g){var l=i[j];if(c.isDate(l)){var h=new Date();h.setHours(0,0,0,0);var k=l-h,f=k/1000/60/60/24;if(f>=0&&f<=6){if(f<1){g.set("innerHTML","Today");}else{if(f<2){g.set("innerHTML","Tomorrow");}else{g.set("innerHTML",e.DataType.Date.format(l,{format:"%A"}));}}}else{if(f>-2&&f<0){g.set("innerHTML","Yesterday");}else{g.set("innerHTML",e.DataType.Date.format(l,{format:"%x"}));}}}},hash:function(f){return function(j,l,g){var i=f;var k=e.one(i),h=e.JSON.parse(k.get("innerHTML"));g.set("innerHTML",h[j[l]]);};},progress:function(){return function(l,n,j){var h=parseInt(l[n],0),o='<div class="yui3-dp-cellrenderer-progress-text">{text}</div>',f='<div class="yui3-dp-cellrenderer-progress" style="width: {width}%">{textnode}</div>',g='<div class="yui3-dp-cellrenderer-progress-wrap">{bar}</div>';var i=e.substitute(o,{text:h+"%"});var m=e.substitute(f,{width:h,textnode:i});var k=e.substitute(g,{bar:m});j.append(a.create(k));};}};var c=e.Lang,a=e.Node;e.namespace("DP").Table=e.Base.create("dp-table",e.Widget,[],{initializer:function(){this.publish("success",{defaultFn:this._defResponseSuccessFn});this.publish("loading",{defaultFn:this._defLoadingFn});this._ioHandlers={complete:e.bind(this._handleResponse,this,"complete"),success:e.bind(this._handleResponse,this,"success"),failure:e.bind(this._handleResponse,this,"failure"),end:e.bind(this._handleResponse,this,"end")};},destructor:function(){this._tbodyNode.detach("click");this._tbodyNode.detach("mouseenter");this._tbodyNode.detach("mouseleave");this._tbodyNode=null;this._tableNode=null;},renderUI:function(){this._tbodyNode=a.create(e.substitute(this.TBODY_TEMPLATE,{className:this.getClassName("tbody")}));this._tableNode=a.create(e.substitute(this.TABLE_TEMPLATE,{className:this.getClassName("table")}));this._tableNode.append(this._tbodyNode);this.get("contentBox").append(this._tableNode);},bindUI:function(){this.after("queryUpdate",this.handleParameterChange);this._tbodyNode.delegate("selectstart",function(f){f.preventDefault();},"tr",this);this.after("dataChange",this._afterDataChange);this.after("loadingChange",this._afterLoadingChange);this.after("queryParametersChange",this._afterQueryParametersChange);},syncUI:function(){this.load("");},_ioHandlers:null,_tbodyNode:null,_tableNode:null,_renderTableRows:function(){var j=this.get("data"),o,q=this.get("cells");this._tbodyNode.set("content","");if(j.results.length>0){for(var k=0;k<j.results.length;k++){o=(k%2)?"row":"row-alt";var l=a.create(e.substitute(this.ROW_TEMPLATE,{trClassName:this.getClassName(o)}));for(var n=0;n<q.length;n++){var p=q[n],m=p.field,g=p.width,h=a.create(e.substitute(this.CELL_TEMPLATE,{tdClassName:this.getClassName("cell")}));if(undefined===p.renderer){h.setContent(j.results[k][m]);}else{var f=p.renderer({value:j.results[k][m]});if(f!==undefined){h.setContent(f);}}h.set("width",g);l.append(h);}this._tbodyNode.append(l);}}else{this._tbodyNode.append(a.create(e.substitute(this.ZEROROWS_TEMPLATE,{colspan:this.get("cells").length,message:this.get("strings.zerorows")})));}},load:function(f){var g=this.get("dataSource");this._io=g.sendRequest({request:f,callback:this._ioHandlers});this.fire("loading",{id:this._io,request:f});},_handleResponse:function(f,g){this.fire(f,{id:this._io,response:g.response});this._io=null;},handleParameterChange:function(f){var g=this.get("queryParameters");g[f.type]=f.parameters;this.set("queryParameters",g);},_defResponseSuccessFn:function(f){this.set("data",f.response);this.set("loading",false);},_defLoadingFn:function(f){this.set("loading",true);},_afterDataChange:function(f){this._renderTableRows();},_afterLoadingChange:function(f){var g=this.get("loading");if(g){}else{}},_afterQueryParametersChange:function(){var j=this.get("queryParameters"),h=Array(),i,g;for(i in j){for(g in j[i]){if(j[i][g].length>0){h.push(g+"="+j[i][g]);}}}var f="?"+h.join("&");this.load(f);},ZEROROWS_TEMPLATE:'<tr><td colspan="{colspan}">{message}</td></tr>',ROW_TEMPLATE:'<tr class="{trClassName}"></tr>',CELL_TEMPLATE:'<td class="{tdClassName}"></td>',TABLE_TEMPLATE:'<table class="{className}"></table>',TBODY_TEMPLATE:'<tbody class="{className}"></tbody>'},{NAME:"dp-table",ATTRS:{strings:{value:{loading:"Loading...",zerorows:"No results available"}},cells:{value:Array()},dataSource:{value:null},data:{value:null},loading:{value:false,validator:c.isBoolean},queryParameters:{value:Array(),validator:c.isArray}}});var c=e.Lang,b="asc",d="desc";e.namespace("DP").TableHeaders=e.Base.create("dp-table-headers-plugin",e.Plugin.Base,[],{initializer:function(f){this.publish("sort",{defaultFn:this._defSortFn});this.publish("columnover",{defaultFn:this._uiSetColumnOver});this.publish("columnout",{defaultFn:this._uiSetColumnOut});this.publish("queryUpdate",{defaultFn:this._defQueryUpdateFn,bubbles:true});this.afterHostMethod("renderUI",this.renderUI,this);this.afterHostMethod("bindUI",this.bindUI,this);},renderUI:function(){this._renderTableHead();this._renderTableHeadColumns();},bindUI:function(){this.after("columnsChange",this._afterColumnsChange);this._theadNode.delegate("selectstart",function(f){f.preventDefault();},"th",this);this._theadNode.delegate("click",function(f){this.fire("sort",{headerTarget:f.currentTarget});},"th",this);this._theadNode.delegate("mouseenter",function(f){this.fire("columnover",{headerTarget:f.currentTarget});},"th",this);this._theadNode.delegate("mouseleave",function(f){this.fire("columnout",{headerTarget:f.currentTarget});},"th",this);},syncUI:function(){},destructor:function(){this._theadNode.detach("selectstart");this._theadNode.detach("click");this._theadNode.detach("mouseenter");this._theadNode.detach("mouseleave");this._theadNode=null;},sort:function(g,h){var f=this.get("columns");for(var i=0;i<f.length;i++){if(f[i].node==g){switch(f[i].sort){case b:f[i].sort=(undefined===h)?d:h;
break;case d:f[i].sort=(undefined===h)?"":h;break;default:f[i].sort=(undefined===h)?b:h;}break;}}this.set("columns",f);},_afterColumnsChange:function(i){var h=this.get("columns"),f=Array();for(var j=0;j<h.length;j++){var g=h[j];f["sort["+g.key+"]"]=g.sort;switch(g.sort){case b:if(g.sortNode.hasClass(this.get("host").getClassName("sort","desc"))){g.sortNode.removeClass(this.get("host").getClassName("sort","desc"));}g.sortNode.addClass(this.get("host").getClassName("sort","asc"));break;case d:if(g.sortNode.hasClass(this.get("host").getClassName("sort","asc"))){g.sortNode.removeClass(this.get("host").getClassName("sort","asc"));}g.sortNode.addClass(this.get("host").getClassName("sort","desc"));break;default:if(g.sortNode.hasClass(this.get("host").getClassName("sort","desc"))){g.sortNode.removeClass(this.get("host").getClassName("sort","desc"));}if(g.sortNode.hasClass(this.get("host").getClassName("sort","asc"))){g.sortNode.removeClass(this.get("host").getClassName("sort","asc"));}}}this.fire("queryUpdate",{parameters:f});},_renderTableHead:function(){this._theadNode=a.create(e.substitute(this.THEAD_TEMPLATE,{className:this.get("host").getClassName("thead")}));this.get("host")._tableNode.append(this._theadNode);},_renderTableHeadColumns:function(){var f=this.get("columns"),g;for(var h=0;h<f.length;h++){f[h].node=a.create(e.substitute(this.COLUMN_TEMPLATE,{className:this.get("host").getClassName("th"),labelClassName:this.get("host").getClassName("th","label"),label:f[h].title||""}));f[h].sortNode=a.create(e.substitute(this.COLUMN_SORT_INDICATOR_TEMPLATE,{className:this.get("host").getClassName("sort")}));f[h].node.append(f[h].sortNode);if(h===0){f[h].node.addClass(this.get("host").getClassName("column","leftcorner"));}else{if(h==(f.length-1)){f[h].node.addClass(this.get("host").getClassName("column","rightcorner"));}}this._theadNode.append(f[h].node);}},_defSortFn:function(f){this.sort(f.headerTarget);},_defQueryUpdateFn:function(f){},_uiSetColumnOver:function(g){var f=g.headerTarget;if(!f.hasClass(this.get("host").getClassName("header","over"))){f.addClass(this.get("host").getClassName("header","over"));}},_uiSetColumnOut:function(g){var f=g.headerTarget;if(f.hasClass(this.get("host").getClassName("header","over"))){f.removeClass(this.get("host").getClassName("header","over"));}},_theadNode:null,THEAD_TEMPLATE:'<thead class="{className}"></thead>',ROW_TEMPLATE:'<tr class="{className}"></tr>',COLUMN_TEMPLATE:'<th class="{className}"><span class="{labelClassName}">{label}</span></th>',COLUMN_SORT_INDICATOR_TEMPLATE:'<div class="{className}">&nbsp;</div>'},{NS:"headers",NAME:"tableHeaders",ATTRS:{columns:{value:Array()}}});},"@VERSION@",{requires:["substitute","json-parse","node","widget","datatype","dataschema","datasource","node-pluginhost"]});YUI.add("gallery-dp-table",function(a){},"@VERSION@",{use:["dp-table"],skinnable:false});