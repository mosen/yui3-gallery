YUI.add("gallery-datatable-checkbox-select",function(e,t){DtCheckboxSelect=function(){},e.mix(DtCheckboxSelect.prototype,{_subscrChkAll:null,_subscrChk:null,_chkRecords:[],tmplTH:'<input type="checkbox" class="{className}" title="{columnTitleTH}"/>',colSelect:"chkSelect",initializer:function(){return this},destructor:function(){this._unbindCheckboxSelect(),this._chkRecords=null},checkboxSelectAll:function(){this._chkRecords=[],this.data.each(function(e){var t=this._getPKValues(e);t&&this._chkRecords.push(t)},this),this._uiCheckboxSetEach(!0),this._uiAllChecksSet(!0),this.fire("checkboxSetAll")},checkboxClearAll:function(){this._chkRecords=[],this._uiCheckboxSetEach(!1),this._uiAllChecksSet(!1),this.fire("checkboxClearAll")},_bindCheckboxSelect:function(){this._subscrChk=this.delegate("click",this._onCheckboxSelect,"tr ."+this.getClassName("checkbox","select"),this),this._subscrChkAll=this.delegate("click",this._onCheckboxSelectAll,"."+this.getClassName("checkbox","select","all"),this)},_unbindCheckboxSelect:function(){this._subscrChk&&this._subscrChk.detach(),this._subscrChk=null,this._subscrChkAll&&this._subscrChkAll.detach(),this._subscrChkAll=null},_enableCheckboxSelect:function(){this._chkRecords=[],this._uiAddCheckboxTH(),this._bindCheckboxSelect()},_disableCheckboxSelect:function(){this.checkboxClearAll(),this._uiRemoveCheckboxTH(),this._unbindCheckboxSelect()},_setCheckboxSelectMode:function(e){e?this._enableCheckboxSelect():this._disableCheckboxSelect()},_getCheckboxSelected:function(){var t=[];return e.Array.each(this._chkRecords,function(e){var n=this._getRecordforPKvalue(e);t.push({tr:this.getRow(n),record:n,pkvalues:e})},this),t},_setCheckboxSelected:function(t){if(!e.Lang.isArray(t))return!1;this.checkboxClearAll();var n=[],r,i,s,o;return e.Array.each(t,function(e){i=this.data.item(e),s=this._getPKValues(i),r=this.getRow(i),i&&s&&(this._chkRecords.push(s),o=r.one("."+this.getClassName("checkbox","select")),o&&o.set("checked",!0))},this),t},_getCheckboxSelectedFlag:function(t){var n=this._getPKValues(t),r=!1;return e.Lang.isObject(n)?r=this._indexOfObjMatch(this._chkRecords,n):r=e.Array.indexOf(this._chkRecords,n),r!==-1?!0:!1},_onCheckboxSelect:function(t){var n=t.target,r=n.ancestor("tr"),i=this.getRecord(r),s=this._getPKValues(i);if(t.target.get("checked"))this._chkRecords.push(s);else{var o=[];e.Array.each(this._chkRecords,function(e){e!==s&&o.push(e)}),this._chkRecords=o}},_onCheckboxSelectAll:function(e){var t=e.target,n=t.ancestor("tr"),r=this.getRecord(n);e.target.get("checked")?this.checkboxSelectAll():this.checkboxClearAll()},_uiAddCheckboxTH:function(){var t={key:this.colSelect,allowHTML:!0,label:e.Lang.sub(this.tmplTH,{className:this.getClassName("checkbox","select","all"),columnTitleTH:"Select ALL records"}),formatter:function(e){var t=this._getCheckboxSelectedFlag(e.record)?"checked":"";e.value='<input type="checkbox" class="'+this.getClassName("checkbox","select")+'" '+t+"/>",e.className+=" center"}},n=this.get("columns");this.getColumn(this.colSelect)||(this.addColumn(t,0),this.get("rendered")===!0&&this.syncUI())},_uiRemoveCheckboxTH:function(){this.removeColumn(this.colSelect),this.syncUI()},_uiCheckboxSetEach:function(e){var t=this.get("srcNode").all("."+this.getClassName("data")+" ."+this.getClassName("checkbox","select"));t.each(function(t){t.set("checked",e)})},_uiAllChecksSet:function(e){var t=this.get("srcNode").one("."+this.getClassName("checkbox","select","all"));t&&t.set("checked",e)},_valPrimaryKeys:function(){var t=this.get("columns"),n=[];return e.Array.each(t,function(e){if(e&&e.primaryKey&&e.primaryKey===!0){var t=e.key||e.name||null;t&&n.push(t)}}),n},_setPrimaryKeys:function(t){return e.Lang.isArray(t)?pks=t:e.Lang.isString(t)&&(pks=[t]),pks},_getRecordforPKvalue:function(t){var n=this.get("primaryKeys"),r=this.data.filter(function(r){if(e.Lang.isObject(t)){var i=!0;e.Object.each(t,function(e,t){r.get(t)!==e&&(i=!1)});if(i)return!0}else if(r.get(n[0])===t)return!0});return r&&r.length===1?r[0]:r},_getPKValues:function(t){var n=this.get("primaryKeys");if(!n||!e.Lang.isArray(n)||!t)return!1;var r;return n.length===1?r=t.get(n[0]):(r={},e.Array.each(n,function(e){e&&(r[e]=t.get(e))})),r},_indexOfObjMatch:function(t,n){if(!e.Lang.isObject(n)||!e.Lang.isArray(t))return-1;var r=-1;return e.Array.some(t,function(t,i){var s=!0;e.Object.each(n,function(e,n){t[n]!==e&&(s=!1)});if(s)return r=i,!0}),r}}),DtCheckboxSelect.ATTRS={checkboxSelectMode:{value:!1,validator:e.Lang.isBoolean,setter:"_setCheckboxSelectMode"},checkboxSelected:{value:[],validator:e.Lang.isArray,setter:"_setCheckboxSelected",getter:"_getCheckboxSelected"},primaryKeys:{valueFn:"_valPrimaryKeys",setter:"_setPrimaryKeys"}},e.DataTable.CheckboxSelect=DtCheckboxSelect,e.Base.mix(e.DataTable,[e.DataTable.CheckboxSelect])},"@VERSION@",{requires:["datatable-base","datatable-mutable","event-custom"]});
